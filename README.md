# –ü–∞—Ä—Å–µ—Ä SERM 4.0

–î–µ—Å–∫—Ç–æ–ø–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (CustomTkinter) + CLI, –∫–æ—Ç–æ—Ä–æ–µ —á–µ—Ä–µ–∑ Playwright + Chrome —Å–æ–±–∏—Ä–∞–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏–∑ –Ø–Ω–¥–µ–∫—Å–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Excel.

> –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–¥–≤–∞ —Ä–µ–∂–∏–º–∞**: –ø–æ–¥—Ä–æ–±–Ω—ã–π (–Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã) –∏ –±—ã—Å—Ç—Ä—ã–π (–Ø–Ω–¥–µ–∫—Å.–ü–æ–∏—Å–∫), –∞ —Ç–∞–∫–∂–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–∞—Ä—Å–µ—Ä –æ—Ç–∑—ã–≤–æ–≤.

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ß—Ç–æ —ç—Ç–æ –∑–∞ –ø—Ä–æ–µ–∫—Ç](#—á—Ç–æ-—ç—Ç–æ-–∑–∞-–ø—Ä–æ–µ–∫—Ç)
2. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
3. [–¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –∏ –∑–∞–ø—É—Å–∫](#—Ç–æ—á–∫–∏-–≤—Ö–æ–¥–∞-–∏-–∑–∞–ø—É—Å–∫)
4. [–ö–æ–Ω—Ñ–∏–≥ –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏](#–∫–æ–Ω—Ñ–∏–≥-–∏-–æ—Å–Ω–æ–≤–Ω—ã–µ-—Å—É—â–Ω–æ—Å—Ç–∏)
5. [Excel-–≤—ã–≤–æ–¥](#excel-–≤—ã–≤–æ–¥)
6. [–§–∏–ª—å—Ç—Ä—ã POTENTIAL](#—Ñ–∏–ª—å—Ç—Ä—ã-potential)
7. [–†–µ–∂–∏–º ¬´–ø–æ–¥—Ä–æ–±–Ω—ã–π¬ª (–Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã)](#—Ä–µ–∂–∏–º-–ø–æ–¥—Ä–æ–±–Ω—ã–π-—è–Ω–¥–µ–∫—Å–∫–∞—Ä—Ç—ã)
8. [–†–µ–∂–∏–º ¬´–±—ã—Å—Ç—Ä—ã–π¬ª (–Ø–Ω–¥–µ–∫—Å.–ü–æ–∏—Å–∫)](#—Ä–µ–∂–∏–º-–±—ã—Å—Ç—Ä—ã–π-—è–Ω–¥–µ–∫—Å–ø–æ–∏—Å–∫)
9. [–ü–∞—Ä—Å–µ—Ä –æ—Ç–∑—ã–≤–æ–≤](#–ø–∞—Ä—Å–µ—Ä-–æ—Ç–∑—ã–≤–æ–≤)
10. [–ö–∞–ø—á–∞ –∏ ¬´–∫–∞–ø—á–∞ –∑–∞–≤–∏—Å–ª–∞¬ª](#–∫–∞–ø—á–∞-–∏-–∫–∞–ø—á–∞-–∑–∞–≤–∏—Å–ª–∞)
11. [GUI –∏ –ø–æ—Ç–æ–∫–∏](#gui-–∏-–ø–æ—Ç–æ–∫–∏)
12. [–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤](#–ø–æ—à–∞–≥–æ–≤–∞—è-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è-–¥–ª—è-–Ω–æ–≤–∏—á–∫–æ–≤)
13. [–ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è](#—á–∞—Å—Ç—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã-–∏-—Ä–µ—à–µ–Ω–∏—è)

---

## –ß—Ç–æ —ç—Ç–æ –∑–∞ –ø—Ä–æ–µ–∫—Ç
**¬´–ü–∞—Ä—Å–µ—Ä SERM 4.0¬ª** ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–±–∏—Ä–∞–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏–∑ –Ø–Ω–¥–µ–∫—Å–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Excel.

### –†–µ–∂–∏–º—ã
- **–ü–æ–¥—Ä–æ–±–Ω—ã–π** ‚Äî –ø–∞—Ä—Å–∏—Ç –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã (–∫–∞—Ä—Ç–æ—á–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤ —Å–∞–π–¥–±–∞—Ä–µ –∫–∞—Ä—Ç).
- **–ë—ã—Å—Ç—Ä—ã–π** ‚Äî –ø–∞—Ä—Å–∏—Ç –Ø–Ω–¥–µ–∫—Å.–ü–æ–∏—Å–∫ (–±–ª–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π/–∫–∞—Ä—É—Å–µ–ª—å –∫–æ–º–ø–∞–Ω–∏–π –≤ SERP).
- **–û—Ç–¥–µ–ª—å–Ω–æ** ‚Äî –ø–∞—Ä—Å–µ—Ä –æ—Ç–∑—ã–≤–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –≤ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç–∞—Ö.

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `results/.../*.xlsx` (–ª–∏—Å—Ç—ã **FULL** –∏ **POTENTIAL**).

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
```bash
python -m pip install -r requirements.txt
python -m playwright install chrome
python main.py
```

---

## –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –∏ –∑–∞–ø—É—Å–∫
- **–ì–ª–∞–≤–Ω—ã–π entrypoint:** `main.py`
- **GUI –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:** `run_gui()` ‚Üí `app/gui.py`
- **CLI:** `run_cli(args)` –ø—Ä–∏ —Ñ–ª–∞–≥–µ `--cli`

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º CLI –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `ensure_dependencies()`:
1. –ß–∏—Ç–∞–µ—Ç `requirements.txt`.
2. –ï—Å–ª–∏ –º–æ–¥—É–ª–µ–π –Ω–µ—Ç ‚Äî —Å—Ç–∞–≤–∏—Ç —á–µ—Ä–µ–∑ `pip install -r requirements.txt`.
3. –ï—Å–ª–∏ –µ—Å—Ç—å Playwright ‚Äî –¥–µ–ª–∞–µ—Ç `python -m playwright install chrome`.
4. –°—Ç–∞–≤–∏—Ç –º–∞—Ä–∫–µ—Ä `.playwright_installed`.

### –£–ø–∞–∫–æ–≤–∫–∞
- `setup.py` (cx_Freeze) —Å–æ–±–∏—Ä–∞–µ—Ç `exe` –∏ –∫–ª–∞–¥—ë—Ç –ø–∞–ø–∫–∏ `app/`, `config/`, `resources/`, `results/` –≤–Ω—É—Ç—Ä—å —Å–±–æ—Ä–∫–∏.
- –°–∫—Ä–∏–ø—Ç—ã —Å–±–æ—Ä–∫–∏: `build_installer.bat`, `build_mac.sh`.

---

## –ö–æ–Ω—Ñ–∏–≥ –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏
### –ö–æ–Ω—Ñ–∏–≥
- `config/settings.json` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤, –ø—Ä–æ–≥—Ä–∞–º–º—ã, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
- `app/settings_store.py` ‚Äî `load_settings()` / `save_settings()` (–∞—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ `.tmp` + `os.replace`).
- `app/settings_model.py` ‚Äî dataclass-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
  - `PotentialFiltersSettings`
  - `ProgramSettings`
  - `NotificationsSettings`
  - `Settings`

### –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è (–¥–∞–Ω–Ω—ã–µ –¥–ª—è Excel)
–í ¬´–ø–æ–¥—Ä–æ–±–Ω–æ–º¬ª —Ä–µ–∂–∏–º–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Organization` (`app/pacser_maps.py`) —Å –ø–æ–ª—è–º–∏:
- `name`, `phone`, `verified`, `award`
- `vk`, `telegram`, `whatsapp`, `website`
- `card_url`
- `rating`, `rating_count`

---

## Excel-–≤—ã–≤–æ–¥
–§–∞–π–ª —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –≤ `app/excel_writer.py`:
- –°–æ–∑–¥–∞—ë—Ç `workbook` —Å –ª–∏—Å—Ç–∞–º–∏ **FULL** –∏ **POTENTIAL**.
- –ü–∏—à–µ—Ç –∫–æ–ª–æ–Ω–∫–∏:
  - –ù–∞–∑–≤–∞–Ω–∏–µ (—Å –≥–∏–ø–µ—Ä—Å—Å—ã–ª–∫–æ–π –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É)
  - –ù–æ–º–µ—Ä
  - –ì–∞–ª–æ—á–∫–∞ (—Å–∏–Ω—è—è/–∑–µ–ª—ë–Ω–∞—è/–ø—É—Å—Ç–æ)
  - –•–æ—Ä–æ—à–µ–µ –º–µ—Å—Ç–æ
  - –†–µ–π—Ç–∏–Ω–≥
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ü–µ–Ω–æ–∫
  - –í–ö / –¢–ì / –í–∞—Ç—Å–∞–ø (—Å—Å—ã–ª–∫–∏)
  - –°–∞–π—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (—Å—Å—ã–ª–∫–∞)
  - –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É

**–§–∏—à–∫–∞:** `_redistribute_links()` —É–º–µ–µ—Ç —Ä–∞—Å–∫–∏–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫ –∏–∑ `website` –ø–æ `vk/tg/wa`, –∞ –æ—Å—Ç–∞–≤—à—É—é—Å—è –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ ¬´—Å–∞–π—Ç¬ª.

---

## –§–∏–ª—å—Ç—Ä—ã POTENTIAL
`app/filters.py` ‚Üí `passes_potential_filters(row, settings)`

–ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ `settings.potential_filters`:
- `white_list`: –µ—Å–ª–∏ –∑–∞–¥–∞–Ω ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–Ω–æ —Å–ª–æ–≤–æ –∏–∑ whitelist –Ω–∞–π–¥–µ–Ω–æ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏.
- `stop_words`: –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ —Å—Ç–æ–ø-—Å–ª–æ–≤–æ –∏–ª–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞ —à–∫–æ–ª—å–Ω–∞—è –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞ (–°–û–® 12, –ì–ë–û–£ + —Å–æ—à/–¥–æ—É/...) ‚Äî –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç.
  - –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: –µ—Å–ª–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –µ—Å—Ç—å ¬´—á–∞—Å—Ç–Ω‚Ä¶¬ª –∏ —ç—Ç–æ —á–∞—Å—Ç–Ω–∞—è —à–∫–æ–ª–∞/—Å–∞–¥ (—Å–ø–∏—Å–æ–∫ `PRIVATE_EXCEPTION_KEYWORDS`) ‚Äî –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å.
- `exclude_no_phone`: –µ—Å–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ—Ç ‚Üí –≤ POTENTIAL –Ω–µ –∏–¥—ë—Ç.
- `exclude_blue_checkmark`: –µ—Å–ª–∏ ¬´—Å–∏–Ω—è—è¬ª ‚Üí —É–±—Ä–∞—Ç—å.
- `exclude_green_checkmark`: –µ—Å–ª–∏ ¬´–∑–µ–ª—ë–Ω–∞—è/–∑–µ–ª–µ–Ω–∞—è¬ª ‚Üí —É–±—Ä–∞—Ç—å.
- `exclude_good_place`: –µ—Å–ª–∏ –µ—Å—Ç—å ¬´—Ö–æ—Ä–æ—à–µ–µ –º–µ—Å—Ç–æ¬ª ‚Üí —É–±—Ä–∞—Ç—å.
- `max_rating`: –µ—Å–ª–∏ —Ä–µ–π—Ç–∏–Ω–≥ –≤—ã—à–µ –ø–æ—Ä–æ–≥–∞ ‚Üí —É–±—Ä–∞—Ç—å.
- `exclude_noncommercial`: –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç ¬´—à–∫–æ–ª–∞/–±–æ–ª—å–Ω–∏—Ü–∞/–º—Ñ—Ü/–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è/‚Ä¶¬ª –∏ —Ç.–ø. (—Å–ø–∏—Å–æ–∫ `NONCOMMERCIAL_KEYWORDS`).

> –î–∞–∂–µ –µ—Å–ª–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ñ–∏–ª—å—Ç—Ä—ã ‚Äî –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–∏—à–µ—Ç—Å—è –≤ **FULL**, –ø—Ä–æ—Å—Ç–æ –Ω–µ –ø–∏—à–µ—Ç—Å—è –≤ **POTENTIAL**.

---

## –†–µ–∂–∏–º ¬´–ø–æ–¥—Ä–æ–±–Ω—ã–π¬ª (–Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã)
`app/pacser_maps.py` ‚Äî `YandexMapsScraper`

### –û—Å–Ω–æ–≤–Ω–æ–π pipeline
1. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã —Å –∑–∞–ø—Ä–æ—Å–æ–º `query`.
2. –ï—Å–ª–∏ –≤—Å–ø–ª—ã–≤–∞–µ—Ç –∫–∞–ø—á–∞ ‚Äî –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏ –∂–¥—ë—Ç —Ä—É—á–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.
3. **–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö id –∫–∞—Ä—Ç–æ—á–µ–∫** –≤ —Å–ø–∏—Å–∫–µ:
   - `_collect_all_ids(page)`: —á–∏—Ç–∞–µ—Ç `data-id`, —Å–∫—Ä–æ–ª–ª–∏—Ç —Å–ø–∏—Å–æ–∫ (`_scroll_list`), –∫–æ–ø–∏—Ç id, –ø–æ–∫–∞:
     - –Ω–µ —É–ø—ë—Ä—Å—è –≤ –∫–æ–Ω–µ—Ü (3 —Ä–∞–∑–∞ –ø–æ–¥—Ä—è–¥ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ `scrollTop` –±–µ–∑ –Ω–æ–≤—ã—Ö id);
     - –∏–ª–∏ –Ω–µ –±—ã–ª–æ –¥–≤–∏–∂–µ–Ω–∏—è `max_scroll_idle_time`;
     - –∏–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç `limit`.
   - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–∫—Ä–æ–ª–ª —Å–ø–∏—Å–∫–∞ –≤ –Ω–∞—á–∞–ª–æ (`_reset_list_scroll`).
4. **–û—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–∑–±–æ—Ä**:
   - –∏–¥—ë—Ç –ø–æ –≤–∏–¥–∏–º—ã–º –∫–∞—Ä—Ç–æ—á–∫–∞–º;
   - –∫–ª–∏–∫–∞–µ—Ç –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ ‚Üí –∂–¥—ë—Ç —Å–∞–π–¥–±–∞—Ä (`_wait_for_card`);
   - –ø–∞—Ä—Å–∏—Ç –ø–æ–ª—è (`_parse_card`): `name`, `card_url`, `rating`, `count`, `phone`, `verified`, `award`, `vk/telegram/whatsapp`, `website`;
   - –≤—ã–¥–∞—ë—Ç `Organization`.
5. GUI/CLI –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –∫–∞–∂–¥—É—é `Organization` –≤ `ExcelWriter.append(...)`.

---

## –†–µ–∂–∏–º ¬´–±—ã—Å—Ç—Ä—ã–π¬ª (–Ø–Ω–¥–µ–∫—Å.–ü–æ–∏—Å–∫)
`app/parser_search.py` ‚Äî `run_fast_parser`

### –ò–¥–µ—è
–ë—Ä–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏–∑ –≤—ã–¥–∞—á–∏ –Ø–Ω–¥–µ–∫—Å–∞ (–±–ª–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π/–∫–∞—Ä—É—Å–µ–ª—å), —ç—Ç–æ –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω—å—à–µ.

### Pipeline
1. `build_serp_url(query, lr)` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç URL –≤–∏–¥–∞:
   ```
   https://yandex.ru/search/?lr=<lr>&text=<query>&serp-reload-from=companies&noreask=1
   ```
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É, –¥–∞–ª—å—à–µ `parse_serp_cards(...)`:
   - –µ—Å–ª–∏ –∫–∞–ø—á–∞ ‚Üí –∂–¥–∞—Ç—å;
   - `_load_all_cards`: –Ω–∞—Ö–æ–¥–∏—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º `.OrgCard` –∏ —Ç.–ø., –∫–ª–∏–∫–∞–µ—Ç —Å—Ç—Ä–µ–ª–∫—É –∫–∞—Ä—É—Å–µ–ª–∏, –ø–æ–∫–∞:
     - —Ä–∞—Å—Ç—ë—Ç —á–∏—Å–ª–æ –∫–∞—Ä—Ç–æ—á–µ–∫;
     - –∏–ª–∏ –Ω–µ ¬´–∑–∞—Å—Ç–æ–ø–æ—Ä–∏–ª–æ—Å—å¬ª –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ü–∏–∫–ª–æ–≤.
3. –ü–æ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ:
   - –±–µ—Ä—ë—Ç ¬´snapshot¬ª JS-—Å–∫—Ä–∏–ø—Ç–æ–º (`_extract_card_snapshot`);
   - –∏–∑–≤–ª–µ–∫–∞–µ—Ç `name`, `rating`, `reviews`, `verified`, `website`, `phone`, `url`.
4. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ `oid` –∏–ª–∏ `name|reviews`.
5. –ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç rows ‚Üí `Organization` (—á–∞—Å—Ç—å –ø–æ–ª–µ–π –ø—É—Å—Ç—ã–µ: `tg/vk/wa/award`).
6. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ Excel, –ø—Ä–∏–º–µ–Ω—è—è `passes_potential_filters` (–ª–∏—Å—Ç **POTENTIAL**).

> –í `parse_serp_cards` –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Ä–æ–¥–µ `max_clicks/arrow_delay_ms/card_delay_ms/phone_delay_ms`, –Ω–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `max_clicks` –ø–æ—á—Ç–∏ –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ‚Äî –ø–æ—Ö–æ–∂–µ, —ç—Ç–æ –Ω–∞—Å–ª–µ–¥–∏–µ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏.

---

## –ü–∞—Ä—Å–µ—Ä –æ—Ç–∑—ã–≤–æ–≤
`app/reviews_parser.py` ‚Äî `YandexReviewsParser`

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Å—ã–ª–∫—É/ID –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –≤–∏–¥—É:
  ```
  https://yandex.ru/maps/org/<id>/reviews/
  ```
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É, –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–ø–∞–ø—ã.
- –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç, –ø–æ–∫–∞ –Ω–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã –ø–µ—Ä–µ—Å—Ç–∞—é—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è (`max_scroll_idle_time`).
- –ü–∞—Ä—Å–∏—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç–∑—ã–≤–∞:
  - `user_name` + `user_profile_url`
  - `rating` (–ø–æ —á–∏—Å–ª—É –∑–≤—ë–∑–¥ `._full`)
  - `review_date`
  - `review_text`
  - `response_date` / `response_text` (–µ—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–≤–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏)

### Excel
`app/reviews_excel_writer.py`:
- –ü–∏—à–µ—Ç –ª–∏—Å—Ç **FULL**.
- –û—Ç–¥–µ–ª—å–Ω—ã–µ –ª–∏—Å—Ç—ã ¬´1 –∑–≤–µ–∑–¥–∞¬ª ‚Ä¶ ¬´5 –∑–≤—ë–∑–¥¬ª.
- –í –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–æ–ª–æ–Ω–∫–µ **¬´–í–°–Ø –ò–ù–§–ê¬ª** —Å–∫–ª–µ–∏–≤–∞–µ—Ç –ø–æ–ª—è –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É.

---

## –ö–∞–ø—á–∞ –∏ ¬´–∫–∞–ø—á–∞ –∑–∞–≤–∏—Å–ª–∞¬ª
`app/captcha_utils.py`

- `is_captcha(page)` ‚Äî —ç–≤—Ä–∏—Å—Ç–∏–∫–∞ –ø–æ URL/title/—Å–µ–ª–µ–∫—Ç–æ—Ä–Ω—ã–º –º–∞—Ä–∫–µ—Ä–∞–º.
- `wait_captcha_resolved(...)` ‚Äî —Ü–∏–∫–ª –æ–∂–∏–¥–∞–Ω–∏—è:
  - –≤—ã–∑—ã–≤–∞–µ—Ç `hook("detected"/"still"/"cleared")`;
  - –∂–¥—ë—Ç, –ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ—à–∏—Ç –∫–∞–ø—á—É;
  - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `page.wait_for_timeout`, —á—Ç–æ–±—ã Playwright Sync API –Ω–µ ¬´–∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–ª¬ª –±—Ä–∞—É–∑–µ—Ä.

### CaptchaFlowHelper
- –ï—Å–ª–∏ —Ä–µ–∂–∏–º `headless` ‚Üí –ø—Ä–∏ –∫–∞–ø—á–µ –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å –≤–∏–¥–∏–º—ã–π Chrome, –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ cookies —Ç—É–¥–∞, –¥–∞—Ç—å —Ä–µ—à–∏—Ç—å, –ø–æ—Ç–æ–º –≤–µ—Ä–Ω—É—Ç—å cookies –æ–±—Ä–∞—Ç–Ω–æ –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.
- –£–º–µ–µ—Ç ¬´whitelist flow¬ª: –æ—Ç–∫—Ä—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ ¬´–¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö¬ª —Å—Ç—Ä–∞–Ω–∏—Ü –Ø–Ω–¥–µ–∫—Å–∞ –∏ –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–∫–ª–∏–∫–∏/—Å–∫—Ä–æ–ª–ª—ã), –∑–∞—Ç–µ–º –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥.
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω `captcha_whitelist_event` (–≤ GUI –∫–Ω–æ–ø–∫–∞ ¬´–ö–∞–ø—á–∞ –∑–∞–≤–∏—Å–ª–∞¬ª).

> –í –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å **–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `CaptchaFlowHelper`**:
> - –æ–¥–∏–Ω –≤ `app/captcha_utils.py` (–∏–º –ø–æ–ª—å–∑—É—é—Ç—Å—è maps/reviews),
> - –≤—Ç–æ—Ä–æ–π –ø–æ—á—Ç–∏ —Ç–∞–∫–æ–π –∂–µ –≤–Ω—É—Ç—Ä–∏ `app/parser_search.py` (–¥–ª—è fast —Ä–µ–∂–∏–º–∞).

---

## GUI –∏ –ø–æ—Ç–æ–∫–∏
`app/gui.py` ‚Äî `ParserGUI`

### UI
- –ø–æ–ª–µ ¬´–Ω–∏—à–∞¬ª, –ø–æ–ª–µ ¬´–≥–æ—Ä–æ–¥¬ª + –∫–Ω–æ–ø–∫–∏ üé≤ (–∏–∑ —Å–ø–∏—Å–∫–æ–≤ `NICHES`, `CITIES`)
- –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å ¬´–ø–æ–¥—Ä–æ–±–Ω—ã–π/–±—ã—Å—Ç—Ä—ã–π¬ª
- –ª–æ–≥-–æ–∫–Ω–æ + –ø—Ä–æ–≥—Ä–µ—Å—Å–±–∞—Ä
- –∫–Ω–æ–ø–∫–∏: **–ó–∞–ø—É—Å—Ç–∏—Ç—å / –°—Ç–æ–ø / –ü–∞—É–∑–∞ / –ü—É—Å–∫ / –û—Ç–∑—ã–≤—ã / –†–µ–∑—É–ª—å—Ç–∞—Ç—ã**
- –≤—Å–ø–ª—ã–≤–∞—à–∫–∞ ¬´–ö–∞–ø—á–∞¬ª (—Å –∫–Ω–æ–ø–∫–æ–π ¬´–ö–∞–ø—á–∞ –∑–∞–≤–∏—Å–ª–∞¬ª ‚Üí `captcha_whitelist_event.set()`)

### –ü–æ—Ç–æ–∫–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- –∑–∞–ø—É—Å–∫ —Å–æ–∑–¥–∞—ë—Ç `threading.Thread(target=_run_worker, ...)`;
- —Å–æ–±—ã—Ç–∏—è:
  - `_stop_event` ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
  - `_pause_event` ‚Äî –ø–∞—É–∑–∞
  - `_captcha_event` ‚Äî ¬´–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–Ω–æ–≤–∞ / –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å¬ª (resume)
  - `_captcha_whitelist_event` ‚Äî –∑–∞–ø—É—Å–∫ ¬´whitelist flow¬ª
- –ª–æ–≥ –∏ —Å—Ç–∞—Ç—É—Å—ã –≤ UI –∏–¥—É—Ç —á–µ—Ä–µ–∑ `queue.Queue`, UI –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –¥—Ä–µ–Ω–∏—Ç –æ—á–µ—Ä–µ–¥—å `root.after(...)`.

---

## –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤
–ù–∏–∂–µ ‚Äî –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è ¬´–¥–ª—è —á–∞–π–Ω–∏–∫–æ–≤¬ª: –æ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è Excel-—Ñ–∞–π–ª–∞.

### 1) –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
#### 1.1 –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python
- –°–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python **3.10+**: https://www.python.org/downloads/
- –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫—É **‚ÄúAdd Python to PATH‚Äù**.

#### 1.2 –°–∫–∞—á–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç
- –ï—Å–ª–∏ –≤—ã –ø–æ–ª—É—á–∏–ª–∏ –∞—Ä—Ö–∏–≤ ‚Äî —Ä–∞—Å–ø–∞–∫—É–π—Ç–µ –µ–≥–æ –≤ —É–¥–æ–±–Ω—É—é –ø–∞–ø–∫—É.
- –ï—Å–ª–∏ —ç—Ç–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Git ‚Äî –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞.

### 2) –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–æ–¥–∏–Ω —Ä–∞–∑)
```bash
python -m pip install -r requirements.txt
python -m playwright install chrome
```

### 3) –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫ (GUI)
1. –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
   ```bash
   python main.py
   ```
2. –û—Ç–∫—Ä–æ–µ—Ç—Å—è –æ–∫–Ω–æ –ø—Ä–æ–≥—Ä–∞–º–º—ã.
3. –£–∫–∞–∂–∏—Ç–µ –Ω–∏—à—É –∏ –≥–æ—Ä–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä: *¬´—Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è¬ª*, *¬´–ö–∞–∑–∞–Ω—å¬ª*).
4. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º (**slow** –∏–ª–∏ **fast**).
5. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –∑–∞–ø—É—Å–∫–∞.

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ `results/`.

### 4) –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É (CLI)
```bash
python main.py --cli --query "–Ω–∏—à–∞ –≤ –≥–æ—Ä–æ–¥"
```

–ï—Å–ª–∏ `--query` –Ω–µ —É–∫–∞–∑–∞–Ω, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ–ø—Ä–æ—Å–∏—Ç –≤–≤–µ—Å—Ç–∏ –Ω–∏—à—É –∏ –≥–æ—Ä–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏.

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
python main.py --cli --query "—Å–∞–ª–æ–Ω—ã –∫—Ä–∞—Å–æ—Ç—ã –≤ –ö–∞–∑–∞–Ω–∏"
python main.py --cli --query "—é—Ä–∏—Å—Ç—ã –≤ –ú–æ—Å–∫–≤–µ" --mode fast
```

### 5) –ß—Ç–æ –≤—ã–±—Ä–∞—Ç—å: slow –∏–ª–∏ fast?
**slow**
- –ú–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç –±–æ–ª—å—à–µ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π —Å –∫–∞—Ä—Ç–æ—á–µ–∫.
- –•–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å –∏ –±–æ–ª—å—à–µ –ø–æ–ª–µ–π.

**fast**
- –ë—ã—Å—Ç—Ä–µ–µ, –∏–¥—ë—Ç –ø–æ –ø–æ–∏—Å–∫–æ–≤–æ–π –≤—ã–¥–∞—á–µ.
- –ü–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –º–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –±—ã—Å—Ç—Ä–æ.

### 6) –ì–¥–µ –∏—Å–∫–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–í—Å–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫–µ `results/`.  
–¢–∞–º —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è –ø–∞–ø–∫–∞ –ø–æ –Ω–∏—à–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:
```
results/
  —Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è/
    —Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è_–ö–∞–∑–∞–Ω—å_12.03_14-30.xlsx
```

### 7) –ü–æ–ª–µ–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `config/settings.json` (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ).  
–¢–∞–º –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å:
- —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ª–∏–¥–æ–≤ (–±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞, —Å/–±–µ–∑ –≥–∞–ª–æ—á–µ–∫, —Ä–µ–π—Ç–∏–Ω–≥);
- –∑–∞–ø—É—Å–∫ –±—Ä–∞—É–∑–µ—Ä–∞ (headless);
- —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

### 8) –ö–∞–ø—á–∞
–ï—Å–ª–∏ –Ø–Ω–¥–µ–∫—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–ø—á—É, –ø–∞—Ä—Å–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∏ –±—É–¥–µ—Ç –∂–¥–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è.  
–ü—Ä–æ–π–¥–∏—Ç–µ –∫–∞–ø—á—É –≤ –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –±—Ä–∞—É–∑–µ—Ä–µ ‚Äî –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–∞—Ä—Å–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É.

### 9) –õ–æ–≥–∏
–õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª `results/<–Ω–∏—à–∞>/log.txt`.  
–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ª–æ–≥-—Ñ–∞–π–ª —á–µ—Ä–µ–∑ `--log`.

---

## –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è
**–ù–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä Playwright**
```bash
python -m playwright install chrome
```

**–ù–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
```bash
python -m pip install -r requirements.txt
```

**–ù–µ—Ç –æ–∫–Ω–∞/–±—Ä–∞—É–∑–µ—Ä–∞ (–∑–∞–ø—É—Å–∫ –±–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)**
```bash
python main.py --cli --query "–Ω–∏—à–∞ –≤ –≥–æ—Ä–æ–¥" --headless true
```

---

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å–±–æ—Ä–∫—É (exe/portable), –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.
